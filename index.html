<!doctype html>
<html lang="en">
  <head>
    <link rel="stylesheet" href="http://openlayers.org/en/v3.10.1/css/ol.css" type="text/css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" integrity="sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ==" crossorigin="anonymous">
    <style>
      .map {
        height: 400px;
        width: 100%;
      }
    </style>
    <script src="http://openlayers.org/en/v3.10.1/build/ol.js" type="text/javascript"></script>
    <script src="jquery.js"></script>
    <script src="angular.js"></script>
    <title>Food Access Map</title>
  </head>
  <body>
    <div id="content"  ng-app ng-controller="displayFunct">
      <div style="margin: 0 auto; width:960px;">
        <div class="row">
         <h1>Food Access Map</h1>
        </div>
        <div class="row">
          <div class="col-md-8">
           <div id="map" class="map"></div>
          </div>
          <div class="col-md-4">
            <div class="row">
              {{name}}
            </div>
            <div class="row">
              {{lsad}}
            </div>
          </div>
        </div>
      </div>
    </div>
  
    <script type="text/javascript">
    function displayFunct ($scope) {

      var style = new ol.style.Style({
        fill: new ol.style.Fill({
          color: 'rgba(255, 255, 255, 0.3)'
        }),
        stroke: new ol.style.Stroke({
          color: '#319FD3',
          width: 1
        }),
        text: new ol.style.Text({
          font: '10px Calibri,sans-serif',
          fill: new ol.style.Fill({
            color: '#000'
          }),
          stroke: new ol.style.Stroke({
            color: '#fff',
            width: 3
          })
        })
      });

      var highlight = new ol.style.Style({
        fill: new ol.style.Fill({
          color: 'rgba(0, 255, 0, 0.6)'
        }),
        stroke: new ol.style.Stroke({
          color: '#009900',
          width: 3
        }),
        text: new ol.style.Text({
          font: '10px Calibri,sans-serif',
          fill: new ol.style.Fill({
            color: '#000'
          }),
          stroke: new ol.style.Stroke({
            color: '#fff',
            width: 3
          })
        })
      });

      var styles = [style];

      var vectorLayer = new ol.layer.Vector({
        source: new ol.source.Vector({
          url: 'vote.geojson',
          format: new ol.format.GeoJSON()
        }),
        style: function(feature, resolution) {
          style.getText().setText(resolution < 50 ? feature.get('NAME10') : '');
          return styles;
        }
      });

      $scope.lastFeat = null;
      //not working for no reason but whatever
      $scope.name = '';
      $scope.lsad = '';
      
      var map = new ol.Map({
        target: 'map',
        layers: [
          new ol.layer.Tile({
            source: new ol.source.OSM({layer: 'sat'})
          }),
          vectorLayer
        ],
        view: new ol.View({
          center: ol.proj.fromLonLat([-89.4,43.0699]),
          zoom: 13
        })
      });

      map.getViewport().addEventListener("click", function(e) { 
        map.forEachFeatureAtPixel(map.getEventPixel(e), function (feature, layer) {
            if($scope.lastFeat)
              $scope.lastFeat.setStyle(style);

            feature.setStyle(highlight);
            $scope.lastFeat = feature;
            setProps(feature.get('NAME10'), feature.get('LSAD10'));
        });
      });

      function setProps(name, lsad){
        $scope.name = name;
        $scope.lsad = lsad;
        console.log(name, lsad);
      }

      }
    </script>
  </body>
</html>
